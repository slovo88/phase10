(this.webpackJsonpphase10=this.webpackJsonpphase10||[]).push([[0],{15:function(e,t,a){e.exports=a(32)},20:function(e,t,a){},21:function(e,t,a){},32:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(13),o=a.n(c),u=(a(20),a(3)),i=(a(21),a(14));var l=function(e){var t=e.userList,a=e.isHost,n=e.removeUser;return r.a.createElement("ul",null,t.map((function(e,t){return r.a.createElement("li",{className:"".concat(e.uid," ").concat(e.host&&"host"),key:"userList-".concat(t)},e.displayName,a&&!e.host&&r.a.createElement("button",Object(i.a)({key:"remove-".concat(e.uid),className:"remove-user",onClick:function(){return n(e.uid)}},"key","remove-".concat(e.uid)),"Remove user"))})))};var s=function(e){var t=e.error,a=e.isLoading,n=e.isNewUser,c=e.displayName,o=e.onDisplayNameSubmit,u=e.startGame,i=e.userList,s=e.isHost,d=e.removeUser;return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement("p",{dangerouslySetInnerHTML:{__html:t}}),a?r.a.createElement("p",null,"loading..."):n?n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Welcome!"),r.a.createElement("p",null,"Please enter a username to join the game"),r.a.createElement("label",{htmlFor:"display-name"},"Name:"),r.a.createElement("input",{id:"display-name",type:"text",placeholder:"Display Name"}),r.a.createElement("button",{onClick:o},"Submit")):r.a.createElement("p",null,c),s&&!n&&i.length>0&&r.a.createElement("button",{onClick:u},"Start Game"),r.a.createElement(l,{userList:i,isHost:s,removeUser:d}))};var d=function(e){var t=e.card,a=e.onClick,n=t[1]||t,c=n.color,o=n.value;return r.a.createElement("div",{onClick:a,"data-card-id":t[0],className:"card ".concat(c)},o)},m=a(10),f=a.n(m);f.a.initializeApp({apiKey:"AIzaSyD7owlkcXvzdS8vHY2s3mt_Me-93ma2NZI",authDomain:"phase10-pemo.firebaseapp.com",databaseURL:"https://phase10-pemo.firebaseio.com",projectId:"phase10-pemo",storageBucket:"phase10-pemo.appspot.com",messagingSenderId:"879568671948",appId:"1:879568671948:web:fcf63e12d457b22afade69",measurementId:"G-M6NSG0LYQ8"});var v=f.a,h=v.database();function g(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e.splice(0,a);n.forEach((function(e){h.ref("game/userList/".concat(t,"/currentHand")).push(e)}))}var p={initializePhase10:function(e){return h.ref("game/userList").once("value").then((function(t){var a=0;t.forEach((function(t){a++,t.child("gameScore").ref.set(0),t.child("currentPhase").ref.set(1),t.child("hasLaidPhaseThisRound").ref.set(!1),t.child("currentHand").ref.remove(),t.child("turnOrder").ref.set(a),t.child("isCurrentTurn").ref.set(!1),t.child("hasDrawnThisTurn").ref.set(!1),t.child("scoreAddedThisRound").ref.set(0),e.find((function(e){return e.uid===t.val().uid})).turnOrder=a})),h.ref("game/currentRound").set(0),function(e){var t=e.length;h.ref("game/currentRound").once("value",(function(a){var n=a.val();h.ref("game/currentRound").set(n++);var r=function(){for(var e=[],t=["red","yellow","green","blue"],a=0;a<t.length;a++){var n=t[a];e.push({value:"S",color:"black"});for(var r=1;r<=12;r++)e.push({value:r,color:n}),e.push({value:r,color:n}),1!==r&&2!==r||e.push({value:"W",color:"black"})}return function(e){for(var t=e.length-1;t>0;t--){var a=Math.floor(Math.random()*(t+1)),n=[e[a],e[t]];e[t]=n[0],e[a]=n[1]}return e}(e)}(),c=10*t;for(h.ref("game/discardPile").set(r.splice(c,1)),e.forEach((function(e){g(r,e.uid,10)})),h.ref("game/drawPile").set(r);n>t;)n-=t;var o=e.find((function(e){return e.turnOrder===n})).uid;h.ref("game/userList/".concat(o,"/isCurrentTurn")).set(!0)}))}(e)}))},drawFromPile:function(e,t){h.ref("game/".concat(e)).once("value",(function(a){var n=a.val();console.log({deck:n}),g(n,t),console.log({deck:n}),h.ref("game/".concat(e)).set(n),h.ref("game/userList/".concat(t,"/hasDrawnThisTurn")).set(!0)}))},discardFromHand:function(e,t,a,n){console.log(e,t,a,n);var r="game/userList/".concat(e,"/currentHand/").concat(a);if(h.ref(r).once("value",(function(e){var t=e.val();h.ref("game/discardPile").once("value",(function(e){var a=e.val()||[];a.push(t),h.ref("game/discardPile").set(a)}))})),h.ref(r).remove(),t<=1)h.ref("game/state").set("round-end");else{var c=n.find((function(e){return e.isCurrentTurn})),o=n.find((function(e){return e.turnOrder===c.turnOrder+1}))||n.find((function(e){return 1===e.turnOrder}));!function(e,t){h.ref("game/userList/".concat(e,"/isCurrentTurn")).set(!1),h.ref("game/userList/".concat(t,"/hasDrawnThisTurn")).set(!1),h.ref("game/userList/".concat(t,"/isCurrentTurn")).set(!0)}(c.uid,o.uid)}}};var b=function(e){var t=e.isTopOfDiscardSkip,a=e.setIsTopOfDiscardSkip,c=v.database(),o=Object(n.useState)({color:null,value:null}),i=Object(u.a)(o,2),l=i[0],s=i[1];return Object(n.useEffect)((function(){return c.ref("game/discardPile").on("value",(function(e){var n=e.val()?e.val()[e.val().length-1]:{color:"black",value:"empty"};s(n),console.log(n),"S"===n.value?a(!0):t&&a(!1)})),function(){c.ref("game/discardPile").off()}}),[]),r.a.createElement(d,{card:l})};var E=function(e){var t=e.children;return r.a.createElement("div",null,t)};var O=function(){var e=v.database(),t=Object(n.useState)(0),a=Object(u.a)(t,2),c=a[0],o=a[1];Object(n.useEffect)((function(){return e.ref("game/drawPile").on("value",(function(e){var t=e.val()||[];o(t.length)})),function(){e.ref("game/drawPile").off()}}),[]);var i={color:"black draw-pile",value:c};return r.a.createElement(d,{card:i,className:"draw-pile"})};var j=function(e){var t=e.toggleModal,a=e.children;return r.a.createElement("div",{style:{position:"fixed",top:0,bottom:0,left:0,right:0,backgroundColor:"orange"}},r.a.createElement("div",{style:{height:"50px",top:0}},r.a.createElement("div",{style:{position:"absolute",right:10,padding:"15px"},onClick:function(){return t(!1)}},"X")),a)},S=p.drawFromPile,y=p.discardFromHand,k=v.database();var w=function(e){var t=e.currentHand,a=e.userId,c=e.userList,o=Object(n.useState)(!1),i=Object(u.a)(o,2),l=i[0],s=i[1],m=Object(n.useState)(!1),f=Object(u.a)(m,2),v=f[0],h=f[1],g=Object(n.useState)(!1),p=Object(u.a)(g,2),w=p[0],L=p[1],P=Object(n.useState)(!1),T=Object(u.a)(P,2),N=T[0],C=T[1],D=Object(n.useState)(!1),I=Object(u.a)(D,2),H=I[0],A=I[1],R=Object(n.useState)(r.a.createElement("div",null,"Something went wrong, reach out to Pemo")),F=Object(u.a)(R,2),M=F[0],U=F[1];function x(e){var n=e.target.getAttribute("data-card-id");y(a,t.length,n,c),A(!1)}return Object(n.useEffect)((function(){return k.ref("/game/userList/".concat(a,"/")).on("value",(function(e){var t=e.val();s(t.isCurrentTurn||!1),h(t.hasDrawnThisTurn||!1),L(t.hasLaidPhaseThisRound||!1)})),function(){k.ref("/game/userList/".concat(a,"/isCurrentTurn")).off()}}),[]),r.a.createElement("div",null,H&&r.a.createElement(j,{toggleModal:A},M),r.a.createElement(O,null),r.a.createElement(b,{isTopOfDiscardSkip:N,setIsTopOfDiscardSkip:C}),r.a.createElement(E,null,t&&t.map((function(e,t){return r.a.createElement(d,{card:e,key:"card-".concat(t,"-").concat(e[1].value)})}))),l?v?r.a.createElement("div",null,r.a.createElement("h3",null,"Pick one"),w?r.a.createElement("button",null,"Play on a laid phase"):r.a.createElement("button",null,"Lay down phase"),r.a.createElement("button",{onClick:function(){var e=t.length;e>1?(U(r.a.createElement("div",null,r.a.createElement("h1",null,"Select card to discard"),r.a.createElement(E,null,t&&t.map((function(e,t){return r.a.createElement(d,{card:e,key:"card-".concat(t,"-").concat(e[1].value),onClick:x})}))))),A(!0)):y(a,e,t[0],c)}},"Discard and end turn")):r.a.createElement("div",null,r.a.createElement("h3",null,"Pick one"),r.a.createElement("button",{onClick:function(){return S("drawPile",a)}},"Draw from draw pile"),!N&&r.a.createElement("button",{onClick:function(){return S("discardPile",a)}},"Draw from discard pile")):r.a.createElement(r.a.Fragment,null))};var L=function(){var e=v.database(),t=Object(n.useState)(""),a=Object(u.a)(t,2),c=(a[0],a[1]),o=Object(n.useState)(!1),i=Object(u.a)(o,2),l=i[0],d=i[1],m=Object(n.useState)(!0),f=Object(u.a)(m,2),h=f[0],g=f[1],b=Object(n.useState)(""),E=Object(u.a)(b,2),O=E[0],j=E[1],S=Object(n.useState)(!1),y=Object(u.a)(S,2),k=y[0],L=y[1],P=Object(n.useState)(0),T=Object(u.a)(P,2),N=T[0],C=T[1],D=Object(n.useState)([]),I=Object(u.a)(D,2),H=I[0],A=I[1],R=Object(n.useState)(""),F=Object(u.a)(R,2),M=F[0],U=F[1],x=Object(n.useState)([]),z=Object(u.a)(x,2),G=z[0],B=z[1];function W(t){e.ref("/game/userList/".concat(t)).once("value",(function(e){var a=e.val();a?(c(a.displayName),g(!1),_(t,a.displayName),B(Object.entries(a.currentHand||{})||[])):(d(!0),g(!1))}))}function _(t,a){e.ref("/game/userList").once("value",(function(n){var r=[];if(n.forEach((function(e){var a=e.val();r.push(a),a.host&&t===a.uid&&L(!0)})),r.length>=6)U("There are already 6 people in this game.<br>An update is coming soon to allow watching matches.");else if(!(-1!==r.findIndex((function(e){return e.uid===t})))){var c=!r.length;e.ref("/game/userList/").child(t).set({displayName:a,uid:t,host:c,score:0,gameScore:0,currentPhase:1,hasLaidPhaseThisRound:!1})}}))}return Object(n.useEffect)((function(){var t=localStorage.getItem("p10-user-id"),a=t;t?(C(t),W(t)):(v.auth().signInAnonymously().then((function(e){var t=e.user;localStorage.setItem("p10-user-id",t.uid)})).catch((function(e){var t=e.code,a=e.message;console.log(a,t)})),v.auth().onAuthStateChanged((function(e){if(e){var t=e.uid;C(t),a=t}})),W(N)),e.ref("/game/userList").on("value",(function(e){var t=[];e.forEach((function(e){t.push(e.val())})),A(t)})),e.ref("/game/userList").on("child_changed",(function(e){var t=e.val();H.find((function(e){return e.uid===t.uid}))})),e.ref("/game/state").on("value",(function(e){j(e.val())})),e.ref("/game/userList/".concat(a,"/currentHand")).on("value",(function(e){B(Object.entries(e.val()||{}))}))}),[]),r.a.createElement("div",{className:"App ".concat(N)},r.a.createElement("style",null,"\n        li.".concat(N," {\n          font-weight: bold;\n          color: seagreen;\n        }\n\n        li.").concat(N,'::after {\n          content: " (you)"\n        }\n\n        li.host::after {\n          content: " (host)"\n        }\n\n        li.').concat(N,'.host::after {\n          content: " (you, host)"\n        }\n        ')),r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"Phase 10")),r.a.createElement("main",null,h?r.a.createElement("p",null,"loading..."):"pregame"===O||l?r.a.createElement(s,{error:M,isNewUser:l,onDisplayNameSubmit:function(t){t.preventDefault();var a=document.getElementById("display-name").value;e.ref("/users/".concat(N,"/displayName")).set(a),c(a),_(N,a),d(!1)},isHost:k,userList:H,startGame:function(){p.initializePhase10(H).then((function(){e.ref("game/state").set("round")}))},removeUser:function(t){e.ref("game/userList/".concat(t)).remove(),e.ref("users/".concat(t)).remove()}}):"round"===O?r.a.createElement(w,{currentHand:G,userList:H,userId:N}):r.a.createElement("p",null,"Loading...")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[15,1,2]]]);
//# sourceMappingURL=main.5c4372c5.chunk.js.map